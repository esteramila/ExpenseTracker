@page "/categories"
@using ExpenseTracker.Services;
@using ExpenseTracker.Data.Models
@inject CategoryService Service;
@rendermode InteractiveServer

<h3>Categories</h3>
<ul>
	@if (categories == null)
    {
        <li>Loading...</li>
    }
    else
    {
        @foreach (var category in categories)
        {
            <li>
                @category.Name
                <button @onclick="() => DeleteCategory(category.Id)">Delete</button>
            </li>
        }
    }
</ul>

<h5>Add a New Category</h5> 
@*this boy got that virus*@
<form @onsubmit="AddCategory">
    <input type="text" @bind="newCategoryName" placeholder="Category Name" />
    <button type="submit">Add</button>
</form>

@code {
	List<Category> categories /*= new List<Category>
	{
		new Category { Id=1, Name="Food" },
		new Category { Id=2, Name="House" },
		new Category { Id=3, Name="Entertainment" }
	}*/;
	private string newCategoryName;

	protected override async Task OnInitializedAsync()
	{
		categories = await Service.GetAllCategoriesAsync();
	}

    private async Task AddCategory()
    {
        if (!string.IsNullOrWhiteSpace(newCategoryName))
        {
            var newCategory = new Category { Name = newCategoryName };
            newCategory = await Service.AddCategoryAsync(newCategory);
            categories.Add(newCategory);

            newCategoryName = string.Empty; // Clear the input field
        }
    }

    private async Task DeleteCategory(int id)
    {
        await Service.DeleteCategoryAsync(id);
        var category = categories.FirstOrDefault(c => c.Id == id);
        if (category != null)
        {
            categories.Remove(category);
        }
    }
}
